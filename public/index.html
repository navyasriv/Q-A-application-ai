<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🎙️ Voice Q&A</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-purple-500 to-indigo-600 flex items-center justify-center h-screen text-white font-sans">
  
  <div class="bg-white/10 backdrop-blur-md p-8 rounded-2xl shadow-lg w-96 text-center">
    <h2 class="text-2xl font-bold mb-6 flex items-center justify-center gap-2">
      🎙️ Voice Q&A
    </h2>
    
    <!-- Buttons -->
    <div class="flex justify-center gap-4 mb-6">
      <button id="startBtn" class="flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 rounded-lg shadow-md transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M6 4l12 6-12 6V4z" />
        </svg>
        Start
      </button>
      
      <button id="stopBtn" disabled class="flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg shadow-md transition disabled:opacity-50 disabled:cursor-not-allowed">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M6 6h8v8H6V6z" />
        </svg>
        Stop
      </button>
    </div>

    <!-- Audio Player -->
    <div class="mt-4">
      <audio id="player" autoplay class="w-full rounded-lg shadow-md"></audio>
    </div>
  </div>

  <script>
    let mediaRecorder, audioChunks = [];

    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const player = document.getElementById("player");

    startBtn.onclick = async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];

      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
      mediaRecorder.start();

      startBtn.disabled = true;
      stopBtn.disabled = false;
    };

    stopBtn.onclick = async () => {
      mediaRecorder.stop();
      mediaRecorder.onstop = async () => {
        const blob = new Blob(audioChunks, { type: "audio/webm" });

        // Send to backend
        const formData = new FormData();
        formData.append("audio", blob, "question.webm");

        const resp = await fetch("/ask", { method: "POST", body: formData });
        const audioBlob = await resp.blob();

        // Create temp audio URL
        const url = URL.createObjectURL(audioBlob);
        player.src = url;

        // Cleanup after play
        player.onended = () => {
          URL.revokeObjectURL(url);  // free memory
        };

        startBtn.disabled = false;
        stopBtn.disabled = true;
      };
    };
    
  </script>
</body>
</html>
